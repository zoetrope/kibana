[[visualize]]
== Visualize

データを可視化するために _Visualize_ ページを利用することができます。
これらの可視化したものは、保存したり、個別に利用したり、 _ダッシュボード_ で組み合わせて利用したりすることができます。
可視化は、以下のデータソースタイプのいずれかに基づいて作成することができます。

* 対話的に作成する新しい検索条件
* 保存されている検索条件
* 保存されている可視化

可視化はElasticsearch 1.xで導入された {ref}search-aggregations.html[aggregation] 機能を利用しています。

[float]
[[createvis]]
=== 新しい可視化の作成

新しい可視化ウィザードを開始するには、ページの左上にある *Visualize* タブをクリックします。
すでに可視化を作っているのであれば、検索バーの右のツールバーから *New Visualization* ボタン image:images/K4NewDocument.png[New Document button] をクリックします。
このウィザートは、以下の手順であなたを導きます。

[float]
[[newvis01]]
==== Step 1: 可視化タイプの選択

新しい可視化ウィザードを開始したら、まず可視化タイプを選択します。

[horizontal]
<<area-chart,Area chart>>:: 範囲グラフを利用すると、いくつかの異なる系列の合計寄与率を可視化します。
<<data-table,Data table>>:: データテーブルは、aggregationにより構成された生のデータを表示します。
可視化の下部をクリックすると、いくつかの他の可視化からデータテーブルを表示することができます。
<<line-chart,Line chart>>:: 折れ線グラフは、異なる系列のデータを比較します。
<<markdown-widget,Markdown widget>>:: Markdownウィジェットは、自由な情報やダッシュボードで何らかの指示を表示するために追加います。
<<metric-chart,Metric>>:: 統計は、ダッシュボードで統計結果の数値を表示するために使います。
<<pie-chart,Pie chart>>:: 円グラフは、合計値に対してそれぞれのソースの寄与率を表示します。
<<tilemap,Tile map>>:: タイルマップは、aggregationした結果を、地図上の点に関連付けます。
<<vertical-bar-chart,Vertical bar chart>>:: 棒グラフは、一般的な目的のグラフとして利用します。

作成して保存した可視化は、ロードすることも可能です。
*Settings > Edit Saved Objects* にアクセスすると、保存した可視化を管理することができます。
この画面には名前によって可視化をフィルタリングするためのテキストフィールドと、オブジェクトエディタへのリンクがあります。

新しく作成する可視化がMarkdownウィジェットならば、タイプを選択したあとに、ウィジェットに表示したいテキストを入力するテキストフィールドがあらわれます。
それ以外のタイプの可視化ならば、タイプを選択したあとに、データソースの選択画面があらわれます。

[float]
[[newvis02]]
==== Step 2: データソースの選択

可視化のデータソースとして、新しい検索条件、または、保存した検索条件を選択することができます。
検索条件は、単一のインデックスまたは複数のインデックスに関連づけられています。
_new search_ を選択した場合は、ドロップダウンからインデックスパターンを選択して、Visualization Editorに進んでください。

保存した検索条件から可視化をつくる場合は、その検索条件が可視化に結び付けられます。
可視化に結びついた検索条件を変更した場合、自動的に可視化が更新されます。

[float]
[[visualization-editor]]
==== Step 3: The Visualization Editor

Visualization Editorでは、可視化の設定や変数をおこなうことができます。
Visualization Editorは、以下の要素から構成されています:

1. <<toolbar-panel,Toolbar>>
2. <<aggregation-builder,Aggregation Builder>>
3. <<preview-canvas,Preview Canvas>>

image:images/VizEditor.jpg[]

[float]
[[toolbar-panel]]
===== Toolbar

ツールバーはインタラクティブにデータを検索するための検索フィールドと、可視化の保存や読み込みを管理するためのコントロールを持ちます。
保存した検索条件をベースにした可視化の場合、検索バーはグレイアウトされます。
検索条件を編集するためには、検索条件フィールドをダブルクリックし、保存された検索条件を編集したものと置き換えてください。

検索ボックスの右のツールバーには、新しい可視化を作成するためのボタン、現在の可視化を保存するためのボタン、保存した可視化をロードするためのボタン、可視化をシェアしたり埋め込んだりするためのボタン、現在の可視化のデータを更新するためのボタンがあります。

[float]
[[aggregation-builder]]
===== Aggregation Builder

ページの左側にあるAggregation Builderを利用すると {ref}search-aggregations-metrics.html[metric] と {ref}search-aggregations-bucket.html[bucket] aggregationを設定することができます。
bucketとは、SQLの `GROUP BY` 文に似たものです。
aggregationに関するより詳しい情報は {ref}search-aggregations.html[Elasticsearch aggregations reference] をご覧ください。

棒グラフ、線グラフ、エリアチャートでは、 _metrics_ をY軸として利用し、 _buckets_ をX軸や、棒の色の分割、列や行の分割などに利用します。
円グラフでは、metricを分割するときのサイズ、bucketを分割する数として利用します。

可視化のY軸としてmetric aggregationを選択してください。例えば以下のものがあります:
{ref}search-aggregations-metrics-valuecount-aggregation.html[count],
{ref}search-aggregations-metrics-avg-aggregation.html[average],
{ref}search-aggregations-metrics-sum-aggregation.html[sum],
{ref}search-aggregations-metrics-min-aggregation.html[min],
{ref}search-aggregations-metrics-max-aggregation.html[max],
{ref}search-aggregations-metrics-cardinality-aggregation.html[cardinality]
(unique count)。
可視化のX軸、色の分割、行や列の分割などのためにbucket aggregationを利用してください。
Use bucket aggregations for the visualization's X axis, color slices, and row/column splits.
共通で利用できるbucket aggregationsには、date histogram, range, terms, filters, and significant termsがあります。

このbucketの実行順序は、設定で変更することができます。
Elasticsearchでは、最初のaggregationが、次のaggregationのためのデータを決定します。
以下の例は、あるWebページでアクセス数の多いファイル拡張子のトップ5の時間ごとのグラフに関するものです。

全アクセスの中から抽出したトップ5の拡張子を利用する場合は、以下の順で設定します:

1.  *Color:* `extensions`フィールドを指定してTerms aggregationを作成します
2.  *X-Axis:* `@timestamp`フィールドを指定してDate histogramを作成します

Elasticsearchは、まずトップ5の拡張子のレコードを収集し、それから拡張子ごとに日付で分割した棒グラフを作成します。

各時間ごとのトップ5の拡張子を図示する場合は、以下の順に設定します:

1.  *X-Axis:* `@timestamp`フィールドを指定してDate histogramを作成します (1時間間隔)
2.  *Color:* `extensions`フィールドを指定してTerms aggregationを作成します

これらのリクエストでは、Elasticsearchは、全レコードから日付で推移するグラフを作成し、それから各bucketの中のトップ5の拡張子をグルーピング(この例では1時間ごと)します。

NOTE: 各bucketは、前のbucketのデータを分割するのだと覚えておいてください。

_preview canvas_ に可視化を描画するには、Aggregation Builderの右上にある緑色の *Apply Changes* ボタンをクリックします。


[float]
[[preview-canvas]]
===== Preview Canvas

preview canvasは、aggregation builderで定義した可視化をプレビュー表示します。
可視化のプレビューを更新するには、ツールバーの *Refresh* ボタン image:images/K4Refresh.png[Refresh button] をクリックします。

include::area_ja.asciidoc[]

include::datatable_ja.asciidoc[]

include::line_ja.asciidoc[]

include::markdown_ja.asciidoc[]

include::metric_ja.asciidoc[]

include::pie_ja.asciidoc[]

include::tilemap_ja.asciidoc[]

include::vertbar_ja.asciidoc[]
