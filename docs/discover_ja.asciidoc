[[discover]]
== Discover
Discoverページでは、インタラクティブにデータの探索をおこなうことができます。
選択したインデックスパターンにマッチしたすべてのインデックスの中にあるすべてのドキュメントにアクセスすることができます。
検索クエリを入力すると、検索結果をフィルタリングし、ドキュメントのデータを見ることができます。
また、検索クエリにマッチしたドキュメントの数を見たり、フィールド値の統計データを取得することができます。
選択されたインデックスパターンに時刻のフィールドが設定されていれば、ページのトップに時間ごとのドキュメントの分布のヒストグラムが表示されます。

image:images/Discover-Start-Annotated.jpg[Discover Page]

[float]
[[set-time-filter]]
=== Time Filterの設定
Time Filterは、検索結果を特定の時間の範囲に限定します。
インデックスが時系列のデータで、インデックスパターンに時刻のフィールドが設定されていれば、Time Filterを利用することができます。

デフォルトでは、Time Filterは直近の15分に設定されています。
タイムピッカーを利用するか、ページのトップにあるヒストグラムで時間の範囲を選択することで、Time Filterを変更することができます。

タイムピッカーでTime Filterを指定する場合:

. メニューバーの右上に表示されているTime Filterをクリックして、タイムピッカーを開きます。
. quick filterの設定は、ショートカットリンクの1つをクリックするだけです。
. 相対時間を指定する場合は、 *Relative* をクリックして、相対的な開始時間を入力します。特定の相対開始時間を秒、分、時間、日、月、年のいずれかで指定することができます。
. 絶対時間を指定する場合は、 *Absolute* をクリックして、 *From* フィールドに開始日時を *To* フィールドに終了日時を指定します。
. タイムピッカーの下にある矢印をクリックすることで、タイムピッカーを閉じることができます。

ヒストグラムからTime Filterを指定する場合は、以下のようにします。

* ズームインしたい時間の範囲を表現しているバーをクリックします。
* 特定の時間の範囲をクリックしてドラッグします。グラフの背景にカーソルをあわせて選択を開始します。選択の開始が可能な位置にマウスをホバーするとカーソルがプラスボタンに変わります。

ブラウザの戻るボタンを利用すると、選択を元に戻すことができます。

このヒストグラム上には、現在探索している時間の範囲と、その範囲が現在使っているインターバルを示しています。
インターバルを変更するには、リンクをクリックして、ドロップダウンからインターバルを変更してください。
デフォルトの振る舞いは、現在の時間の範囲から自動的にインターバルを設定するようになっています。


[float]
[[search]]
=== データの検索
Discoverページでは、現在指定しているインデックスパターンにマッチしたインデックスを探すことができます。
Lucene Lucene https://lucene.apache.org/core/2_9_4/queryparsersyntax.html[query syntax] 、またはJSONベースの {ref}/query-dsl.html[Elasticsearch Query DSL] を使って、単純にクエリを入力することができます。

検索をおこなうと、ヒストグラム、ドキュメントテーブル、フィールドリストが検索結果に応じて更新されます。
ヒストグラムの右上には hits (マッチしたドキュメント) の全件数が表示されます。
ドキュメントテーブルには、hitsの最初の500件のデータが表示されます。
デフォルトでは、hitsは時間の新しい順に並べられています。
Timeカラムのヘッダーをクリックすると、並び順を逆にすることができます。
また、Timeフィールド以外の任意のフィールドの値で並び替えることもできます。
より詳しい情報は <<sorting, Sorting the Documents Table>> を参照してください。

データを検索する方法:

. 検索フィールドにクエリを入力します
+
* 文字列による自由な検索をおこなう場合は、単純に文字列を入力するだけです。たとえば、Webサーバのログを検索する場合に `safari` と入力すれば `safari` という文字列をすべてのフィールドから探します。
+
* 特定のフィールドの値について検索をおこなう場合は、フィールドの名前を値の前に指定します。例えば `status:200` と入力すると `status` フィールドに `200` という値を含むデータのみを検索することができます。
+
* 値の範囲を指定する場合は `[START_VALUE TO END_VALUE]` のように角括弧を利用します。例えば、ステータスコードが 4xx のデータを見つける場合は `status:[400 TO 499]` と指定します。
+
* より複雑な検索クエリを指定する場合は `AND`, `OR`, `NOT` などのような演算子が利用できます。例えば、ステータスコードが 4xx で、拡張子が `php` か `html` のデータを探すためには `status:[400 TO 499] AND (extension:php OR extension:html)` と入力します。
+
NOTE: これらのサンプルでは、Lucene query syntaxを利用しています。これとは別にElasticsearch Query DSLを利用することもできます。詳しくはElasticsearchのリファレンス {ref}/query-dsl-query-string-query.html#query-string-syntax[query string syntax] を参照してください。
+
. キーボードで *Enter* を押すか *Search* ボタンを押して、検索をおこないます。

[float]
[[new-search]]
==== 新しい検索を始める

現在の検索をクリアするか、新しい検索を開始する場合は、ツールバーの *New Search* ボタンをクリックしてください。

image:images/Discover-New-Search.jpg[New Search]

[float]
[[save-search]]
==== 検索の保存
Discoverページでは、保存した検索条件をリロードすることができます。また、それらを <<visualize, visualizations>> で可視化するときに利用することができます。
検索の保存をおこなうと、検索クエリと現在選択中のインデックスパターンの両方が保存されます。

現在の検索を保存するには:

. ツールバーの *Save Search* ボタン image:images/SaveButton.jpg[Save Search button] をクリックします。
. 検索の名前を入力し *Save* をクリックします。

[float]
[[load-search]]
==== 保存した検索のロード
保存した検索をロードするには:

. ツールバーの *Load Search* ボタン image:images/LoadButton.jpg[Load Search button] をクリックします。
. ロードしたい検索を選択します。

もし保存した検索条件のインデックスパターンが、現在選択されているインデックスパターンと異なる場合、その検索をロードすると選択されているインデックスパターンも変わります。

[float]
[[select-pattern]]
==== 検索するインデックスを切り替える
検索条件を入力したとき、現在選択されているインデックスパターンにマッチしたインデックスが検索されます。
現在のインデックスパターンは、Searchフィールドの下に表示されています。
検索するインデックスを変更するには、現在のインデックスパターン名をクリックし、表示されたインデックスパターンのリストから、異なるインデックスパターンを選択します。
インデックスパターンについてより詳しい情報は <<settings-create-pattern, Creating an Index Pattern>> をご覧ください。

[float]
[[auto-refresh]]

include::autorefresh.asciidoc[]

[float]
[[field-filter]]
=== フィールドによるフィルタリング
フィールドに特定の値が含まれるドキュメントだけを表示するように検索結果をフィルタリングすることができます。
また、フィールドに特定の値が含まれるドキュメントを表示するための、ネガティブフィルタをつくることもできます。

フィルターは、フィールドリストまたはドキュメントテーブルから追加することができます。
フィルターを追加したとき、検索クエリの下にフィルターバーが表示されます。
フィルターバーでは、フィルターの有効化、無効化、フィルターの反転(ポジティブフィルターをネガティブフィルターに切り替え、またはその逆)、ON/OFFの切り替え、完全な削除をおこなうことができます。
インデックスパターンの選択のドロップダウンの右にある左向きの矢印をクリックすると、フィールドリストを閉じることができます。

フィールドリストからフィルターを追加する方法:

. フィルターを有効にしたいフィールドの名前をクリックします。これによりそのフィールドのトップ5の値が表示されます。それぞれの値の右に2つ虫眼鏡のボタン(ポジティブフィルターを追加するボタンとネガティブフィルターを追加するボタン)があります。
. ポジティブフィルターを追加するには *Positive Filter* ボタン image:images/PositiveFilter.jpg[Positive Filter Button] をクリックします。
このフィルターにより、このフィールドにこの値を含まないドキュメントが除外されるようになります。
. ネガティブフィルターを追加するには *Negative Filter* ボタン image:images/NegativeFilter.jpg[Negative Filter Button] をクリックします。
これにより、このフィールドにこの値を含むドキュメントが除外されるようになります。

ドキュメントテーブルからフィルターを追加する方法:

. ドキュメントテーブルのドキュメントのエントリーの最初のカラム(最初のカラムは通常は時刻データ)の左にある *Expand* ボタン image:images/ExpandButton.jpg[Expand Button] をクリックして、ドキュメントを展開します。
各フィールド名の右側には2つの虫眼鏡ボタン(ポジティブフィルターを追加するボタンとネガティブフィルターを追加するボタン)があります。
. このドキュメントの値をベースにしてフィールドのポジティブフィルターを追加するには *Positive Filter* ボタン image:images/PositiveFilter.jpg[Positive Filter Button] をクリックします。
このフィルターにより、このフィールドにこの値を含まないドキュメントが除外されるようになります。
. このドキュメントの値をベースにしてフィールドのネガティブフィルターを追加するには *Negative Filter* ボタン image:images/NegativeFilter.jpg[Negative Filter Button] をクリックします。
これにより、このフィールドにこの値を含むドキュメントが除外されるようになります。

[float]
[[discover-filters]]
include::filter-pinning.asciidoc[]

[float]
[[document-data]]
=== ドキュメントのデータを見る
検索クエリを入力したとき、クエリにマッチしたドキュメントの最新500件がドキュメントテーブルに表示されます。
ドキュメントテーブルに表示されるドキュメントの数は <<advanced-options,Advanced Settings>> の `discover:sampleSize` プロパティで設定することができます。
デフォルトでは、テーブルには選択されたインデックスパターンで設定した時刻フィールド(ローカライズ済み)と、ドキュメントの `_source` の内容が表示されます。
フィールドリストから <<adding-columns, ドキュメントテーブルにフィールドを追加する>> ことができます。
テーブルに含まれるインデックス化されたフィールドにより <<sorting, ドキュメントの一覧を並び替える>> ことができます。

ドキュメントのフィールドデータを見るためには、ドキュメントのエントリーの最初のカラム(最初のカラムは通常は時刻データ)の左にある *Expand* ボタン image:images/ExpandButton.jpg[Expand Button] をクリックします。
Kibanaは、Elasticsearchからドキュメントデータを読み込み、テーブル上にフィールドを表示します。
このテーブルは、それぞれのフィールドについて、その名前と、フィルターの追加ボタンと、フィールドの値を含む列があります。

image::images/Expanded-Document.png[]

. オリジナルのJSONドキュメント(整形済み)を表示するには *JSON* タブをクリックします。
. 分離されたページとしてドキュメントデータを見るためには、リンクをクリックします。特定のドキュメントに直接アクセスするためのリンクは、ブックマークしたり、シェアしたりすることが可能です。
. ドキュメントの詳細を展開したい場合は *Collapse* ボタン image:images/CollapseButton.jpg[Collapse Button] をクリックします。
. image:images/add-column-button.png[Add Column] *Toggle column in table* ボタンをクリックすると、ドキュメントテーブルに表示するカラムを切り替えることができます。

[float]
[[sorting]]
==== ドキュメントの一覧を並び替える

いずれかのインデックス化されたフィールドの値を使って、ドキュメントテーブル内のドキュメントを並び替えることができます。
選択されたインデックスパターンに時刻フィールドが設定されている場合は、デフォルトで時刻の新しい順にドキュメントが並んでいます。

ソート順を切り替える方法:

* 並び替えをしたいフィールドの名前をクリックします。
並び替えに利用できるフィールドには、フィールド名の右側にソートボタンがあります。
フィールド名を2回クリックすると、並び順が逆になります。

[float]
[[adding-columns]]
==== ドキュメントテーブルにフィールドを追加する
デフォルトでは、ドキュメントテーブルには選択されたインデックスパターンで設定した時刻フィールド(ローカライズ済み)と、ドキュメントの `_source` の内容が表示されます。
フィールドリスト、または展開されたドキュメントのビューから、このテーブルにフィールドを追加することができます。

ドキュメントテーブルにフィールドカラムを追加する方法:

. フィールドリストのフィールド上にマウスオーバーし *add* ボタン image:images/AddFieldButton.jpg[Add Field Button] をクリックします。
. ドキュメントテーブルに表示したいフィールドをすべて追加するまで繰り返します。
. 一方、image:images/add-column-button.png[Add Column] *Toggle column in table* ボタンをクリックすることで、展開されたドキュメントのビューから直接フィールドを追加します。

追加されたフィールドカラムは、ドキュメントテーブルの `_source` カラムと置き換えられます。
また、追加れたフィールドは、フィールドリストの一番上の *Selected Fields* セクションに表示されます。

テーブルのカラムを再配置したい場合は、動かしたいカラムのヘッダにマウスオーバーし *Move* ボタンをクリックしてください。

image:images/Discover-MoveColumn.jpg[Move Column]

[float]
[[removing-columns]]
==== ドキュメントテーブルからフィールドカラムを削除する
ドキュメントテーブルからフィールドカラムを削除する方法:

. フィールドリストの *Selected Fields* セクションから、削除したいフィールドにマウスオーバーし *remove* ボタン image:images/RemoveFieldButton.jpg[Remove Field Button] をクリックします。
. ドキュメントテーブルからなくしたいすべてのフィールドを削除するまで繰り返します。

[float]
[[viewing-field-stats]]
=== フィールドデータの統計情報を見る

フィールドリストでは、ドキュメントテーブルにそのフィールドを持つドキュメントがどれだけあるのか、TOP5の値は何であるのか、それぞれの値の割合はどれくらいなのかを見ることができます。

フィールドデータの統計情報を見る方法:

* フィールドリストのフィールド名をクリックします。フィールドリスト内であればどこでも(Selected Fields, Popular Fields, その他のフィールド)クリックすることができます。

image:images/Discover-FieldStats.jpg[Field Statistics]

TIP: フィールドをベースに可視化をする場合、統計情報の下にある *Visualize* ボタンをクリックします。
